<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiencia AR Iguaz√∫</title>
    
    <!-- A-Frame y MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        /* ... (estilos iguales) ... */
    </style>
</head>
<body>
    <!-- ... (mismo HTML) ... -->
    
    <script>
        // Registrar el shader de chroma key
        AFRAME.registerShader('chroma', {
            schema: {
                src: {type: 'map'},
                color: {type: 'color', default: '#00FF00'},
                threshold: {type: 'number', default: 0.1},
            },

            init: function (data) {
                this.texture = new THREE.VideoTexture(document.querySelector(data.src));
                this.texture.minFilter = THREE.LinearFilter;
                this.material = new THREE.ShaderMaterial({
                    uniforms: {
                        texture: {value: this.texture},
                        color: {value: new THREE.Color(data.color)},
                        threshold: {value: data.threshold}
                    },
                    vertexShader: `
                        varying vec2 vUv;
                        void main() {
                            vUv = uv;
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `,
                    fragmentShader: `
                        uniform sampler2D texture;
                        uniform vec3 color;
                        uniform float threshold;
                        varying vec2 vUv;
                        
                        void main() {
                            vec4 tColor = texture2D(texture, vUv);
                            float diff = distance(tColor.rgb, color);
                            if (diff < threshold) {
                                discard;
                            }
                            gl_FragColor = tColor;
                        }
                    `,
                    transparent: true
                });
            },

            update: function (data) {
                if (this.texture) {
                    this.texture.dispose();
                }
                this.texture = new THREE.VideoTexture(document.querySelector(data.src));
                this.texture.minFilter = THREE.LinearFilter;
                this.material.uniforms.texture.value = this.texture;
                this.material.uniforms.color.value = new THREE.Color(data.color);
                this.material.uniforms.threshold.value = data.threshold;
            }
        });
    </script>

    <div id="ar-container">
        <a-scene 
            mindar-image="imageTargetSrc: ./marker.mind; 
                         autoStart: true; 
                         uiLoading: yes; 
                         uiScanning: yes; 
                         uiError: yes;" 
            vr-mode-ui="enabled: false" 
            device-orientation-permission-ui="enabled: false"
            loading-screen="enabled: false"
            renderer="colorManagement: true; alpha: true;"
            embedded
        >
            <a-assets>
                <!-- Video sin loop y sin audio -->
                <video 
                    id="ar-video" 
                    src="./asset.webm" 
                    muted 
                    playsinline 
                    crossorigin="anonymous"
                    preload="auto"
                ></video>
            </a-assets>
            
            <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
            
            <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
                <!-- Usamos el shader chroma key para quitar el fondo verde -->
                <a-plane
                    material="shader: chroma; src: #ar-video; color: #00FF00; threshold: 0.1"
                    position="0 0 0"
                    rotation="0 0 0"
                    height="1"
                    width="1.8076923076923077"
                ></a-plane>
            </a-entity>
        </a-scene>
    </div>

    <script>
        // ... (el resto del script JavaScript igual) ...
    </script>
</body>
</html>
